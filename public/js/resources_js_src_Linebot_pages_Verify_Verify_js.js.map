{"version":3,"sources":["webpack://soat-maintain/./resources/js/src/Linebot/pages/Verify/Verify.js"],"names":["Verify","useLocation","search","history","useHistory","dispatch","useDispatch","useEffect","path","URLSearchParams","localStorage","setItem","get","initialize","liff","liffId","accessToken","userActions","then","push","catch","getItem","redirectUri"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AAEA;AACA;;;AAEA,IAAMA,MAAM,GAAG,SAATA,MAAS,GAAM;AAAA,qBACEC,6DAAW,EADb;AAAA,MACTC,MADS,gBACTA,MADS;;AAEjB,MAAIC,OAAO,GAAGC,4DAAU,EAAxB;AACA,MAAMC,QAAQ,GAAGC,wDAAW,EAA5B;AAEAC,kDAAS,CAAC,YAAM;AACZ,QAAIC,IAAI,GAAG,IAAIC,eAAJ,CAAoBP,MAApB,CAAX;AACAQ,gBAAY,CAACC,OAAb,CAAqB,MAArB,EAA6BH,IAAI,CAACI,GAAL,CAAS,MAAT,CAA7B,EAFY,CAGpB;;AAHoB,aAIGC,UAJH;AAAA;AAAA;;AAAA;AAAA,2HAIZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACUC,yIAAA,CAAU;AAAEC,wBAAM,EAAE;AAAV,iBAAV,CADV;;AAAA;AAEI;AACAD,yJAAA,CAAgB,YAAM;AAClB,sBAAIA,yIAAA,EAAJ,EAAuB;AACnB,wBAAME,WAAW,GAAGF,yIAAA,EAApB;;AAEA,wBAAIE,WAAJ,EAAiB;AACbN,kCAAY,CAACC,OAAb,CAAqB,WAArB,EAAkCK,WAAlC;AAEAX,8BAAQ,CAACY,mEAAA,EAAD,CAAR,CACKC,IADL,CACU,YAAM;AACRf,+BAAO,CAACgB,IAAR,CAAaX,IAAI,CAACI,GAAL,CAAS,MAAT,CAAb;AACH,uBAHL,EAIKQ,KAJL,CAIW,YAAM;AACTjB,+BAAO,CAACgB,IAAR,CACI,yBACIT,YAAY,CAACW,OAAb,CAAqB,MAArB,CAFR;AAIH,uBATL;AAUH;AACJ,mBAjBD,MAiBO;AACH;AACAP,6JAAA,CAAW;AACPQ,iCAAW,EACP,uDAAuDd,IAAI,CAACI,GAAL,CAAS,MAAT;AAFpD,qBAAX;AAIH;AACJ,iBAzBD;;AAHJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAJY;AAAA;AAAA;;AAkCZC,cAAU;AACb,GAnCQ,EAmCN,CAACR,QAAD,EAAWF,OAAX,EAAoBD,MAApB,CAnCM,CAAT;AAqCA,sBACI;AAAK,aAAS,EAAC,SAAf;AAAA,2BACI;AAAG,eAAS,EAAC;AAAb;AADJ,IADJ;AAKH,CA/CD;;AAiDA,+DAAeF,MAAf,E","file":"js/resources_js_src_Linebot_pages_Verify_Verify_js.js","sourcesContent":["import React, { Suspense, useEffect } from \"react\";\r\nimport { useHistory, useLocation } from \"react-router-dom\";\r\nimport { useDispatch } from \"react-redux\";\r\n\r\nimport liff from \"@line/liff\";\r\nimport { userActions } from \"../../redux/actions\";\r\n\r\nconst Verify = () => {\r\n    const { search } = useLocation();\r\n    let history = useHistory();\r\n    const dispatch = useDispatch();\r\n\r\n    useEffect(() => {\r\n        let path = new URLSearchParams(search);\r\n        localStorage.setItem(\"path\", path.get(\"path\"));\r\n// ตรงนี้ต้องเอา Liff login ที่ได้จากการสร้างใน line dev มาใส่ในแถวที่ 18\r\n        async function initialize() {\r\n            await liff.init({ liffId: \"1655658567-YmdRmAVg\" });\r\n            // console.log(path.get(\"path\"));\r\n            liff.ready.then(() => {\r\n                if (liff.isLoggedIn()) {\r\n                    const accessToken = liff.getAccessToken();\r\n\r\n                    if (accessToken) {\r\n                        localStorage.setItem(\"linetoken\", accessToken);\r\n\r\n                        dispatch(userActions.getAuthUser())\r\n                            .then(() => {\r\n                                history.push(path.get(\"path\"));\r\n                            })\r\n                            .catch(() => {\r\n                                history.push(\r\n                                    \"/linebot/login?path=\" +\r\n                                        localStorage.getItem(\"path\")\r\n                                );\r\n                            });\r\n                    }\r\n                } else {\r\n                    // localStorage.setItem(\"path\", path.get(\"path\"));\r\n                    liff.login({\r\n                        redirectUri:\r\n                            \"https://6be7805c3720.ngrok.io/linebot/verify?path=\" + path.get(\"path\"),\r\n                    });\r\n                }\r\n            });\r\n        }\r\n        initialize();\r\n    }, [dispatch, history, search]);\r\n\r\n    return (\r\n        <div className=\"overlay\">\r\n            <i className=\"fa fa-refresh fa-spin\" />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Verify;\r\n"],"sourceRoot":""}